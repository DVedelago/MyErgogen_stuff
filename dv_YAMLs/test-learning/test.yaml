meta:
  engine: 4.1.0

units: 
  # proxy units
  kx:                         U
  ky:                         U

  # padding var
  pxy:                        20

  # mirroring distance
  mirror_dist:                15U

  # outline dims
  outline_dim:                1.5U
  brdOutlPad:                 12
  fillet_radius:              2

points:
  zones:
    alphanum:
      mirror:
        distance:             mirror_dist      
      columns: 
        pinky:
          key.spread:         pxy
          key.splay:          2

        ring:        
          key.spread:         pxy
          key.stagger:        10
          key.splay:          -3
          
        middle:
          key.spread:         pxy
          key.stagger:        5
        
        index:
          key.spread:         pxy
          key.stagger:        -5
          key.splay:          -3
        
        index_stretch:
          key.spread:         U

      rows:
        alpha1:
        alpha2:
        alpha3:
        mod:

    thumbfan:
      mirror:
        distance:             mirror_dist   
      key:
        padding:              pxy
        spread:               pxy
      anchor:
        ref:                  alphanum_index_stretch_alpha1
        shift:                [7,-2] 

      columns:
        spazio:
          key.width:          1.5U
          key.rotate:         -93
          key.splay:          -10
          key.shift:          [U-2,-3] 

        disazio:
          key.rotate:         -5
          key.splay:          -7
          key.shift:          [U,-5]
        
      rows:
        fan:

    numpad:
      anchor:
        ref:                  alphanum_pinky_alpha3
        shift:                [-70,-35]
        rotate:               -2
        
      columns:
        C1:
        C2:
        C3:
    
      rows:
        R1:
        R2:
        R3:
        R4:

     
      
outlines:
  raw:
    - what:                   rectangle
      where:                  true
      size:                   [u,u]

  keys:
    - what:                   rectangle
      where:                  true
      size:                   [0.9u, 0.9u]

  board: 
      - what:                 polygon
        operation:            stack
        points:
          # start from bottom-left corner and go CW
          # bottom left corner of numpad
          - ref:              numpad_C1_R1
            shift:            [-brdOutlPad, -brdOutlPad]
          # upper left corner of numpad
          - ref:              numpad_C1_R4
            shift:            [-brdOutlPad, brdOutlPad]
          # upper right corner of numpad
          - ref:              numpad_C3_R4
            shift:            [brdOutlPad, brdOutlPad]
          # pinky top
          - ref:              alphanum_pinky_mod
            shift:            [-brdOutlPad, brdOutlPad]
          

          # ring top
          - ref:              alphanum_ring_mod
            shift:            [-brdOutlPad, brdOutlPad]
          

          # middle top
          - ref:              alphanum_middle_mod
            shift:            [-brdOutlPad, brdOutlPad]
          - ref:              alphanum_middle_mod
            shift:            [brdOutlPad, brdOutlPad]

          # index top
          # - ref:              alphanum_index_mod
          #   shift:            [-brdOutlPad, brdOutlPad]
          
          # index stretch top
          - ref:              alphanum_index_stretch_mod
            shift:            [brdOutlPad, brdOutlPad]

          - ref:              alphanum_index_stretch_mod
            shift:            [brdOutlPad+15, -2brdOutlPad]
          - ref:              mirror_alphanum_index_stretch_mod
            shift:            [brdOutlPad+15, -2brdOutlPad]

          # mirror index stretch top
          - ref:              mirror_alphanum_index_stretch_mod
            shift:            [brdOutlPad, brdOutlPad] 

          # mirror index top
          # - ref:              mirror_alphanum_index_mod
          #   shift:            [brdOutlPad, brdOutlPad]

          # mirror middle top
          - ref:              mirror_alphanum_middle_mod
            shift:            [brdOutlPad, brdOutlPad]
          - ref:              mirror_alphanum_middle_mod
            shift:            [-brdOutlPad, brdOutlPad] 

          # mirror ring top
          - ref:              mirror_alphanum_ring_mod
            shift:            [-brdOutlPad, brdOutlPad] 
          - ref:              mirror_alphanum_ring_mod
            shift:            [-brdOutlPad, brdOutlPad]

          # mirror pinky top
          # - ref:              mirror_alphanum_pinky_mod
          #   shift:            [brdOutlPad, brdOutlPad]
          - ref:              mirror_alphanum_pinky_mod
            shift:            [-brdOutlPad, brdOutlPad] 

          # mirror pinky bottom                          
          - ref:              mirror_alphanum_pinky_alpha1
            shift:            [-brdOutlPad, -brdOutlPad]
          - ref:              mirror_alphanum_pinky_alpha1
            shift:            [brdOutlPad, -brdOutlPad]

          # # mirror ring bot
          # - ref:              mirror_alphanum_ring_alpha1
          #   shift:            [-brdOutlPad +4, -brdOutlPad]
          # - ref:              mirror_alphanum_ring_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad]

          # # mirror mid bot
          # - ref:              mirror_alphanum_middle_alpha1
          #   shift:            [-brdOutlPad +3, -brdOutlPad]
          # - ref:              mirror_alphanum_middle_alpha1
          #   shift:            [brdOutlPad -3, -brdOutlPad]

          # # mirror index bot
          # - ref:              mirror_alphanum_index_alpha1
          #   shift:            [-brdOutlPad +2, -brdOutlPad]
          # - ref:              mirror_alphanum_index_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad] 

          # # mirror index stretch
          # - ref:              mirror_alphanum_index_stretch_alpha1
          #   shift:            [-brdOutlPad, -brdOutlPad]
          # - ref:              mirror_alphanum_index_stretch_alpha1
          #   shift:            [brdOutlPad -3, -brdOutlPad]  

          # mirror thumbfan 
          - ref:              mirror_thumbfan_spazio_fan
            shift:            [brdOutlPad +3, -brdOutlPad]
          - ref:              mirror_thumbfan_spazio_fan
            shift:            [brdOutlPad +3, brdOutlPad ]

          - ref:              mirror_thumbfan_disazio_fan
            shift:            [brdOutlPad, -brdOutlPad -3]
          - ref:              mirror_thumbfan_disazio_fan
            shift:            [brdOutlPad, -brdOutlPad -3]

          # thumbfan    
          - ref:              thumbfan_disazio_fan
            shift:            [brdOutlPad, -brdOutlPad -3] 
          - ref:              thumbfan_disazio_fan
            shift:            [brdOutlPad, -brdOutlPad -3]

          - ref:              thumbfan_spazio_fan
            shift:            [brdOutlPad +3, brdOutlPad]
          - ref:              thumbfan_spazio_fan
            shift:            [brdOutlPad +3, -brdOutlPad] 

          # # index stretch bot
          # - ref:              alphanum_index_stretch_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad] 
          # - ref:              alphanum_index_stretch_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad]

          # # index bot
          # - ref:              alphanum_index_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad]
          # - ref:              alphanum_index_alpha1
          #   shift:            [-brdOutlPad, -brdOutlPad] 


          # # middle bot
          # - ref:              alphanum_middle_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad] 
          # - ref:              alphanum_middle_alpha1
          #   shift:            [-brdOutlPad, -brdOutlPad]

          # # ring bot
          # - ref:              alphanum_ring_alpha1
          #   shift:            [brdOutlPad, -brdOutlPad] 
          # - ref:              alphanum_ring_alpha1
          #   shift:            [-brdOutlPad, -brdOutlPad]


          # pinky bot
          - ref:              alphanum_pinky_alpha1
            shift:            [brdOutlPad, -brdOutlPad] 
          - ref:              alphanum_pinky_alpha1
            shift:            [-brdOutlPad, -brdOutlPad] 

          # numpad bot right corner
          - ref:              numpad_C3_R1
            shift:            [brdOutlPad, -brdOutlPad]  
        fillet:               fillet_radius     

  # Combination preview showing outline and keys.
  combo:
    - name:                   board
    - operation:              subtract
      name:                   keys


pcbs:
  test:
    outlines:
      main:
        outline:              board
    
    footprints:
      mx_hotswap:
        what:                 mx
        where:                true
        params:
          keycaps:            true
          reverse:            false
          hotswap:            true
          from:               "{{column_net}}"
          to:                 "{{colrow}}"
      diode:
          what:               diode
          where:              true
          params:
            from:             "{{colrow}}"
            to:               "{{row_net}}"
          adjust:
            shift:            [0, -5]
      promicro:
          what:               promicro
          params:
          where:
            ref:
              aggregate:
                parts:        [alphanum_index_stretch_mod, mirror_alphanum_index_stretch_mod]
            shift:            [0,0]
            rotate:           -90
      oled:
        what:                 oled
        params:       
          side:               "F"
          VCC:                {type: 'net', value: 'VCC'},
          GND:                {type: 'net', value: 'GND'},
          SDA:                P2
          SCL:                P3
        where:
          ref:
            aggregate:
              parts:          [alphanum_index_stretch_mod]
          shift:              [0, -1]
          rotate:             -90
      reset:
        what:                 button
        params:               
          from:               GND
          to:                 RST
        where:
          ref:
            aggregate:
              parts:          [alphanum_index_stretch_mod, mirror_alphanum_index_stretch_mod]
          shift:              [0, -1]
          rotate:             -90
      
cases:
